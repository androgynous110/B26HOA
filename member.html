<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="./assets/logo.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Myra+Pro&display=swap" rel="stylesheet">
    <script src="https://cdn.anychart.com/releases/8.13.0/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.13.0/js/anychart-pie.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.13.0/js/anychart-cartesian.min.js"></script>
    
    <script type="module" src="./api/api-statistics.js" defer></script>
    <script type="module" src="./api/api-homeowner.js" defer></script>

    <script type="module" src="./api/supabaseConfiguration.js"></script>

    <script type="module" src="./api/api-announcement.js"></script>
    <script type="module" src="./ui/ui-announcement.js"></script>


    <script type="module" src="./ui/ui-notification.js"></script>
    <script type="module" src="./api/api-notification.js"></script>

    <script type="module" src="./ui/ui-homeowner.js"></script>
    <script type="module" src="./api/api-homeowner.js"></script>

    <script type="module" src="./api/api-dues.js"></script>
    <script type="module" src="./ui/ui-due.js"></script>

    
    <script type="module" src="./ui/ui-concern.js"></script>
    <script type="module" src="./api/api-concerns.js"></script>

    <script type="module" src="./ui/ui-dashboard.js"></script>

    <script type="module" src="./api/auth-guard.js"></script>


    <link rel="stylesheet" href="./css/user.css">
    
    <title>B26HOA Portal</title>
</head>
<body>

    <div class="dashboard">
        <div class="sidebar">
            <div class="profile_logo">
                <img src="./assets/logo.png" alt="">
            </div>

            <div class="navigate">
                <a href="#" onclick="showSection('dashboard')"><i class="fa-solid fa-gauge"></i>Dashboard</a>
                <a href="#" onclick="showSection('notification')"><i class="fa-solid fa-bell"></i>Notifications</a>
                <a href="#" onclick="showSection('anouncement')"><i class="fa-solid fa-bullhorn"></i>Anouncements</a>
                <a href="#" onclick="showSection('due-overview')"><i class="fa-solid fa-coins"></i>Dues</a>
                <a href="#" onclick="showSection('concern')"><i class="fa-solid fa-triangle-exclamation"></i>Concern Managenent</a>
            </div>

            <div class="log">
                 <a id="logout-button"><i class="fa-solid fa-right-from-bracket"></i>Logout</a>
            </div>
        </div>
        <nav>
            <div class="navbar">
                <a onclick="showSection('notification')"><i class="fa-solid fa-bell"></i></a>
                <span class="badge" id="notificationBadge">0</span>
            </div>

            <div class="navbar">
                <span class="badge" id="announcementBadge">0</span>
                <a onclick="showSection('anouncement')"><i class="fa-solid fa-bullhorn"></i></a>
            </div>

            <div class="profile">
                <a href=""><i class="fa-solid fa-circle-user"></i></a>
                <a href=""><i class="fa-solid fa-right-from-bracket"></i></a>
            </div>
        </nav>
    </div>

    <section id="dashboard" class="section active">
        <div class="card-indicator">
            <div class="cards" id="card-duePayment">
                <div class="card-header">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <h2>Recent Due Bill</h2>
                </div>
                <div class="card-body"></div>
            </div>

            <div class="cards" id="card-anouncement">
                <div class="card-header">
                    <i class="fas fa-bullhorn"></i>
                    <h2>Announcements</h2>
                </div>
                <div class="card-body card-anouncement"></div>
            </div>

            <div class="cards" id="card-homeowner">
                <div class="card-header">
                    <i class="fas fa-exclamation-circle"></i>
                    <h2>Concerns</h2>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stat-item" id="userRecentConcerns">
                            <h3>0</h3>
                            <span class="status-badge badge-none">Recent Concerns</span>
                        </div>
                        <div class="stat-item" id="userConcerns">
                            <h3>0</h3>
                            <span class="status-badge badge-none">Total Concerns</span>
                        </div>
                        <div class="stat-item" id="userConcernResolved">
                            <h3>0</h3>
                            <p>RESOLVED</p>
                            <span class="status-badge badge-resolved">Completed</span>
                        </div>
                        <div class="stat-item" id="userConcernUnresolved">
                            <h3>0</h3>
                            <p>UNRESOLVED</p>
                            <span class="status-badge badge-unresolved">Pending</span>
                        </div>
                    </div>
                </div>
            </div>

            
        </div>
        
        <div class="card full-width">
            <div class="card-header">
                <i class="fas fa-history"></i>
                <h2>History Due Payment Logs</h2>
            </div>
            <div class="card-body">
                <div class="table-container" >
                    <table>
                        <thead>
                            <tr>
                                <th>Homeowner Name</th>
                                <th>Description</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="tableHistoryLog"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <section id="notification" class="section">
        <div class="controls">
            <div class="header">
                <h1>🔔 Notifications</h1>           
            </div>
            <div class="rightControls">
                <div class="filter-btn">
                    <label for="typeFilter"><i class="fa-solid fa-filter"></i> Filter</label>
                    <select id="typeFilter"></select>     
                </div>

              <button class="view-btn" onclick="notification.member().switchView('list')"><i class="fa-solid fa-list-ul"></i> </i> List View</button>
              <button class="view-btn" onclick="notification.member().switchView('card')"><i class="fa-solid fa-layer-group"></i></i> Card View</button>
            </div>
        </div>

        <div class="table-container">
            <table id="notificationListView">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Message</th>
                        <th>Created At</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="notificationTable"></tbody>
            </table>
        </div>

        <div id="notificationCardView"></div>
        

        <div id="notificationBadge" class="badge"></div>
    </section>

   <section id="anouncement" class="section">
        

        <div class="controls">
            <div class="header">
                <h1>📢 Announcements</h1>
            </div>
            <div class="rightControls">
                <button class="view-btn" onclick="announcement.member().switchView('list')"> <i class="fa-solid fa-list-ul"></i> List View</button>
                <button class="view-btn" onclick="announcement.member().switchView('card')"><i class="fa-solid fa-layer-group"></i> Card View</button>
            </div>
        </div>

        <div class="table-container">
            <table id="announcementListView">
                <thead>
                    <tr>
                        <th class="title-column">Title</th>
                        <th class="message-column">Message</th>
                        <th class="date-column">Created At</th>
                        <th>Category</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="announcementTable"></tbody>
            </table>
        </div>

        <div id="announcementCardView"></div>

        <div id="announcementBadge" class="badge"></div>

    </section>

    
   <section id="due-overview" class="section">
        
        <div class="controls">
            <div class="header"><h1>💰 Due Overview</h1></div>
            <div class="rightControls">
                <div class="filter-btn">
                    <select id="due_categoryFilter">
                        <option value="all">Select Category</option>
                        <option value="Yearly">Yearly Due</option>
                        <option value="Monthly">Monthly Due</option>
                    </select>
                    <select id="due_statusFilter">
                        <option value="all">Select Status</option>
                        <option>Complete</option>
                        <option>On going</option>
                        <option>Overdue</option>
                    </select>
                   
            </div>
            <button class="view-btn" onclick="due.member().switchView('list')"><i class="fa-solid fa-list-ul"></i> List View</button>
            <button class="view-btn" onclick="due.member().switchView('card')"><i class="fa-solid fa-layer-group"></i> Card View</button>
            </div>
        </div>

        <div class="table-container">
            <table id="dueListView">
                <thead>
                <tr>
                    <th>Receipt No.</th>
                    <th>Home Owner</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Paid Amount</th>
                    <th>Due Date</th>
                    <th>Status</th>
                    <th>Payment Method</th>
                    <th class="note-column">Notes</th>
                    <th>Function</th>
                </tr>
                </thead>
                <tbody id="dueTable"></tbody>
            </table>
        </div>

        <div id="dueCardView"></div>

        <div id="duePaymentModal" class="modal">
            <div class="duePayment-modal-container">
                <form id="partialPaymentForm" class="paymentForm">
                    <h3 class="form-header">Partial Due Payment Form</h3>
                    <input type="hidden" id="editId" />

                    <div class="payment-input-pair"><span><strong>Name:</strong></span><span id="partialHomeownerName">Homeowner Name</span></div>
                    <div class="payment-input-pair"><span><strong>Amount:</strong></span><span id="partialHomeownerAmount">Amount</span></div>
                    <div class="payment-input-pair"><span><strong>Due Type:</strong></span><span id="partialHomeownerType">Type</span></div>
                    <div class="payment-input-pair"><span><strong>Status:</strong></span><span id="partialHomeownerStatus">Status</span></div>
                    <div class="payment-input-pair"><span><strong>Description:</strong></span><span id="partialHomeownerDescription">Description</span></div>
                    <div class="payment-input-pair"><span><strong>Note:</strong></span><span id="partialHomeownerNote">Note</span></div>

                    <div class="payment-input-pair">  
                        <h4>Type of Due:</h4>
                        <select id="partialDueTypeSelect">
                            <option value="Monthly">Monthly</option>
                            <option value="Yearly">Yearly</option>
                        </select>
                    </div>

                    <div class="payment-input-pair">
                        <h4>Paid Amount:</h4>
                        <input type="number" id="partialPaidAmount" step="0.01" required />
                    </div>

                    <div class="payment-input-pair">
                        <h4>Payment Date:</h4>
                        <input type="date" id="partialPaymentDate" />
                    </div>

                    <div class="payment-input-pair">
                        <h4>Late Fee:</h4>
                        <input type="number" id="partialLateFee" step="0.01" />
                    </div>

                    <div class="payment-input-pair">
                        <h4>Payment Method:</h4>
                        <select id="partialPaymentMethod">
                            <option value="Cash">Cash</option>
                            <option value="GCash">GCash</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Check">Check</option>
                        </select>
                    </div>

                    <div class="payment-input-pair">
                        <h4>Note:</h4>
                        <textarea id="partialNote" maxlength="120" rows="2"></textarea>
                    </div>

                    <button class="payment-submit-btn" onclick="due.member().partialPayment()" type="submit">Submit</button>
                    <button class="close-btn" type="button" onclick="due.member().closePaymentForm()"><i class="fa-solid fa-xmark"></i></button>
                </form>

            <div class="dueReceipt">
                <div id="partialReceiptContainer" class="hidden">
                <h2 class="due-header">Due Receipt</h2>
                <div class="receipt">
                    <div class="logos-header">
                    <div class="header-text">
                        <h2>BARANGAY 26 HOMEOWNERS' ASSOCIATION</h2>
                        <p>123 Subdivision, City</p>
                        <p class="official-receipt">Official Receipt</p>
                    </div>
                    <div class="logo-container">
                        <img class="receipt-logo" src="./assets/logo.png" alt="Association Logo" />
                    </div>
                    </div>

                    <div class="receipt-body">
                    <div class="receipt-row"><span>Receipt No:</span><span id="partial-displayReceiptNo">R003-2025-001</span></div>
                    <div class="receipt-row"><span>Date:</span><span id="partial-displayDate">July 5, 2025</span></div>
                    <div class="receipt-row"><span>Homeowner:</span><span id="partial-displayHomeowner">-</span></div>
                    <div class="receipt-row"><span>Description:</span><span id="partial-displayDescription">-</span></div>
                    <div class="receipt-row"><span>Subtotal:</span><span id="partial-displaySubtotal">₱0.00</span></div>
                    <div class="receipt-row"><span>Late Fee:</span><span id="partial-displayLateFee">₱0.00</span></div>
                    <div class="receipt-row total-row"><span>Total Due:</span><span id="partial-displayTotalDue">₱0.00</span></div>
                    <div class="receipt-row"><span>Status:</span><span id="partial-displayStatus">-</span></div>
                    <div class="receipt-row"><span>Amount Paid:</span><span id="partial-displayPaidAmount">₱0.00</span></div>
                    <div class="receipt-row"><span>Balance Due:</span><span id="partial-displayBalance">₱0.00</span></div>
                    <div class="receipt-row"><span>Change:</span><span id="partial-displayChange">₱0.00</span></div>
                    <div class="receipt-row"><span>Payment Method:</span><span id="partial-displayMethod">-</span></div>
                    <div class="receipt-row"><span>Notes:</span><span id="partial-displayNotes">-</span></div>
                    </div>

                    <div class="receipt-footer">
                    <p>Thank you for your payment!</p>
                    </div>

                    <div class="action-buttons">
                        <button class="due-print-btn" onclick="due.member().printReceipt()" type="button">Print Receipt</button>
                    </div>
                </div>
                </div>

                <div id="partialEmptyState">
                <p>No receipt generated yet. Fill the form and click "Submit Payment".</p>
                </div>
            </div>
            </div>
        </div>
    </section>

    <section id="concern" class="section">
        <div class="header">
            <h1>⚠️ Concern Management</h1>
        </div>
       
            <div class="controls">
                <button id="addConcern" onclick="concern.staff().openForm()"><i class="fa-solid fa-plus"></i> Create Concern</button>
                <div class="rightControls">
                    <button class="view-btn" onclick="concern.member().switchView('list')"><i class="fa-solid fa-list-ul"></i> List View</button>
                <button class="view-btn" onclick="concern.member().switchView('card')"><i class="fa-solid fa-layer-group"></i> Card View</button>
                </div>
            </div>

            <div class="table-container">
                <table id="concernListView">
                    <thead>
                    <tr>
                        <th>Title</th>
                        <th>Message</th>
                        <th>Homeowner</th>
                        <th>Date Created</th>
                        <th>Category</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody id="concernTable"></tbody>
                </table>
            </div>

            <div id="concernCardView" class="hidden"></div>
                <div id="createConcernModal" class="modal">
                    <div class="concern-modal">
                    <form id="concernForm">
                        <h2 class="form-header">Concern Report</h2>
                        <h3>Title:</h3> <input id="concernTitle" placeholder="Announcement title" required/>
                        <h3>Message:</h3><textarea id="concernMessage" placeholder="Announcement message" required></textarea>
                        <h3>Category:</h3><input id="concernCategory" placeholder="Announcement title" required>
                        <button class="submit-btn" type="submit">Submit</button>
                        <button class="close-btn" onclick="concern.closeForm()"><i class="fa-solid fa-xmark"></i></button>
                    </form>
                </div>
            </div>
    </section>
</body>
</html>

<script>
    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(sectionId).classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', function() {
        const nav = document.querySelector('nav');
        const sidebar = document.querySelector('.sidebar');

        if (nav && sidebar) {
            nav.addEventListener('click', function(event) {
                if (event.target === nav || event.target.closest('nav::before')) {
                    sidebar.classList.toggle('open');
                    event.stopPropagation(); // Prevent bubbling if needed
                }
            });

            document.addEventListener('click', function(event) {
                if (!sidebar.contains(event.target) && !nav.contains(event.target)) {
                    sidebar.classList.remove('open');
                }
            });
        }
    });
</script>